
<!DOCTYPE html>
<html lang="en" class="dark light">


<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="base" content="https://zhuzaiye.github.io/">

    
    

    
    
        <title>Makefile-ABC</title>
        
            <meta property="og:title" content="Makefile-ABC" />
        
    

    
        
            <meta property="og:description" content="Makefile基础知识和应用" />
        
    

    
        
            <meta name="description" content="Makefile基础知识和应用" />
        
    

    
    

    
    

    
    

    
    
        
        <script src="/js/main.min.709b2cc07788dc81af71cdb44ac921361de4570bb2f7a9ac753efa35798fda5c.js" defer></script>
    

    
    

    
    
        
        <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    

    <link rel="alternate" type="application/atom+xml" title="hzzhu" href="/index.xml">

    
    
    
    

    
        <link rel="stylesheet" href="/sass/theme/light.min.7bebe62a7f0bce52d5ac022ed2f94faa37a1771a19e0e45897652b4bb6aa90a9.css" />
        <link id="darkModeStyle" rel="stylesheet" href="/sass/theme/dark.min.3dc265de402f27bbd2bdc27f57ddc5be9ac23d9a1e5395858431e8bf42dde643.css" />
    

    

    
    
        
        <link rel="stylesheet" href="/sass/main.min.6a3e0207a23ff2bc4a1f7457549ef102c2fa12ae36ec010c44685bd3e66d83d7.css" />
    

    
    

    
    
</head>


<body>
   <div class="page-wrapper">
      <div class="page-container">
         <div class="main-content">
            
            <header>
    <div class="main">
        
        <a href="https://zhuzaiye.github.io/">hzzhu</a>
        

        <div class="socials">
            
            <a rel="me" href="https://github.com/zhuzaiye/" class="social">
                <img alt="github" src="/icons/social/github.svg">
            </a>
            
            <a rel="me" href="mailto:hzzhu92@gmail.com" class="social">
                <img alt="email" src="/icons/social/email.svg">
            </a>
            
            <a rel="me" href="https://twitter.com/pigzhu11" class="social">
                <img alt="twitter" src="/icons/social/twitter.svg">
            </a>
            
            <a rel="me" href="/index.xml" class="social">
                <img alt="rss" src="/icons/social/rss.svg">
            </a>
            
        </div>
    </div>

    <nav>
        
        <a href="/posts">/posts</a>
        
        <a href="/projects">/projects</a>
        
        <a href="/about">/about</a>
        
        <a href="/notes">/notes</a>
        
        |
        
        <a id="dark-mode-toggle" onclick="toggleTheme(); return false;" href="#">
            <img src="/icons/sun.svg" id="sun-icon" style="filter: invert(1)" alt="Light" />
            <img src="/icons/moon.svg" id="moon-icon" alt="Dark" />
        </a>
        
    </nav>
</header>

            
            
<article class="post-single">
    
    <header class="post-header">
        
        <h1 class="post-title">Makefile-ABC</h1>
        
        
        <div class="post-meta">
            
            
            <div class="post-date">
                <time datetime="2023-03-25T09:18:53&#43;08:00">
                    March 25, 2023
                </time>
            </div>
            
            
            
            
            
            
            
            <div class="post-description">
                Makefile基础知识和应用
            </div>
            
        </div>
    </header>

    
    <div class="post-content">
        <p>Makefile是组织编译的命令脚本文件-构建生成可执行文件的依赖关系树.</p>
<blockquote>
<p><code>make</code>根据makefile的规则关系树, 构建出编译可执行程序.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#6272a4"># 目标: 目标依赖
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">#     命令
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#50fa7b">a.out</span><span style="color:#ff79c6">:</span> demo.c
</span></span><span style="display:flex;"><span>    gcc -o <span style="color:#8be9fd;font-style:italic">$@</span> $&lt;
</span></span></code></pre></div><h2 id="make指令">make指令</h2>
<blockquote>
<p>windows 环境</p>
</blockquote>
<p>运行<code>make -v</code>会出现:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f1fa8c">&#39;make&#39;</span> 不是内部命或外部命令, 也不是可执行的程序, 或批处理文件.
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 系统在环境变量中找不到 make 命令执行文件</span>
</span></span></code></pre></div><p>解决方法:</p>
<ol>
<li>找到<code>mingw</code>安装目录, 打开<code>bin</code>目录, 找到<code>mingw32-make.exe</code></li>
<li>将<code>mingw32-make.exe</code>将该文件重命名为<code>make.exe</code></li>
</ol>
<h2 id="编译过程">编译过程</h2>
<p><img src="/imgs/compiler.jpg" alt="cimpiler_processer"></p>
<h2 id="makefile">Makefile</h2>
<ul>
<li>变量 使用 <code>$(val)</code> 获取<code>val</code>的值</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#50fa7b">.PHONY</span><span style="color:#ff79c6">:</span> clean
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">CC</span><span style="color:#ff79c6">=</span>g++
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">BIN</span><span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">exec</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">OBJS</span><span style="color:#ff79c6">=</span>AddTwoSum.o utils.o
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">$(BIN)</span><span style="color:#ff79c6">:</span> <span style="color:#ff79c6">$(</span><span style="color:#8be9fd;font-style:italic">OBJS</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#f1fa8c">&#34;start compiling...&#34;</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#ff79c6">$(</span>CC<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">$(</span>CC<span style="color:#ff79c6">)</span> -o <span style="color:#ff79c6">$(</span>BIN<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">$(</span>OBJS<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#f1fa8c">&#34;compile done&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">AddTwoSum.o</span><span style="color:#ff79c6">:</span> AddTwoSum.cpp
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">$(</span>CC<span style="color:#ff79c6">)</span> -c -o <span style="color:#8be9fd;font-style:italic">$@</span> $&lt;
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">utils.o</span><span style="color:#ff79c6">:</span> utils.cpp
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">$(</span>CC<span style="color:#ff79c6">)</span> -c -o <span style="color:#8be9fd;font-style:italic">$@</span> $&lt;
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">clean</span><span style="color:#ff79c6">:</span>
</span></span><span style="display:flex;"><span>	rm -f <span style="color:#ff79c6">$(</span>BIN<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">$(</span>OBJS<span style="color:#ff79c6">)</span>
</span></span></code></pre></div><ul>
<li>条件复制</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#6272a4">#条件赋值 ?=
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">#追加赋值 +=
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">CC</span> <span style="color:#ff79c6">=</span> g++
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">CC</span> <span style="color:#ff79c6">?=</span> gcc
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">OBJS</span> <span style="color:#ff79c6">=</span> AddTwoSum.o
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">OBJS</span> <span style="color:#ff79c6">+=</span> utils.o
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">echo</span><span style="color:#ff79c6">:</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#ff79c6">$(</span>CC<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#ff79c6">$(</span>OBJS<span style="color:#ff79c6">)</span>
</span></span></code></pre></div><ul>
<li>立即变量和延迟变量</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#6272a4"># 使用 := 赋值, 立即变量
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"># 使用 = 赋值, 延迟变量(关系变量)
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">a</span> <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">b</span> <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">2</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">val_a</span> <span style="color:#ff79c6">:=</span> <span style="color:#ff79c6">$(</span>a<span style="color:#ff79c6">)</span> <span style="color:#6272a4"># val_a=1 解析即赋值 立即解析赋值</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">val_b</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">$(</span>b<span style="color:#ff79c6">)</span>  <span style="color:#6272a4"># val_b的值随着b的变化而变化 绑定变量关系</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">a</span> <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">10</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># b = 20
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#50fa7b">echo</span><span style="color:#ff79c6">:</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#ff79c6">$(</span>val_a<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#ff79c6">$(</span>val_b<span style="color:#ff79c6">)</span>
</span></span></code></pre></div><ul>
<li>自动变量</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#6272a4"># 常用自动变量
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"># $@ 目标
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"># $^ 所有依赖项
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"># $&lt; 目标依赖项中的第一个
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"># $? 所有依赖项中被修改过的
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#50fa7b">.PHONY</span><span style="color:#ff79c6">:</span> clean
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">CC</span><span style="color:#ff79c6">=</span>g++
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">BIN</span><span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">exec</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">OBJS</span><span style="color:#ff79c6">=</span>AddTwoSum.o utils.o
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">$(BIN)</span><span style="color:#ff79c6">:</span> <span style="color:#ff79c6">$(</span><span style="color:#8be9fd;font-style:italic">OBJS</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#f1fa8c">&#34;start compiling...&#34;</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#ff79c6">$(</span>CC<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">$(</span>CC<span style="color:#ff79c6">)</span> -o <span style="color:#8be9fd;font-style:italic">$@</span> $^
</span></span><span style="display:flex;"><span>	@echo <span style="color:#f1fa8c">&#34;compile done&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">AddTwoSum.o</span><span style="color:#ff79c6">:</span> AddTwoSum.cpp
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">$(</span>CC<span style="color:#ff79c6">)</span> -c -o <span style="color:#8be9fd;font-style:italic">$@</span> $&lt;
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">utils.o</span><span style="color:#ff79c6">:</span> utils.cpp
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">$(</span>CC<span style="color:#ff79c6">)</span> -c -o <span style="color:#8be9fd;font-style:italic">$@</span> $&lt;
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">clean</span><span style="color:#ff79c6">:</span>
</span></span><span style="display:flex;"><span>	rm -f <span style="color:#ff79c6">$(</span>BIN<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">$(</span>OBJS<span style="color:#ff79c6">)</span>
</span></span></code></pre></div><ul>
<li>变量替换(模式匹配)</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#50fa7b">.PHONY</span><span style="color:#ff79c6">:</span> echo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">SRC</span> <span style="color:#ff79c6">=</span> demo.c demo1.c
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">OBJ</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">$(</span>SRC:.c<span style="color:#ff79c6">=</span>.o<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">OBJ1</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">$(</span>SRC:%.c<span style="color:#ff79c6">=</span>%.o<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">echo</span><span style="color:#ff79c6">:</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#f1fa8c">&#34;SRC=</span><span style="color:#ff79c6">$(</span>SRC<span style="color:#ff79c6">)</span><span style="color:#f1fa8c">&#34;</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#f1fa8c">&#34;OBJ=</span><span style="color:#ff79c6">$(</span>OBJ<span style="color:#ff79c6">)</span><span style="color:#f1fa8c">&#34;</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#f1fa8c">&#34;OBJ1=</span><span style="color:#ff79c6">$(</span>OBJ1<span style="color:#ff79c6">)</span><span style="color:#f1fa8c">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># SRC=demo.c demo1.c
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"># OBJ=demo.o demo1.o
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"># OBJ1=demo.o demo1.o
</span></span></span></code></pre></div><ul>
<li>环境变量</li>
</ul>
<p>环境变量运行时载入makefile. 如果有相同命名的变量, 系统环境变量会被覆盖.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#50fa7b">.PHONY</span><span style="color:#ff79c6">:</span> echo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">CFLAGS</span> <span style="color:#ff79c6">=</span> -g
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">echo</span><span style="color:#ff79c6">:</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#f1fa8c">&#34;CFLAGS = </span><span style="color:#ff79c6">$(</span>CFLAGS<span style="color:#ff79c6">)</span><span style="color:#f1fa8c">&#34;</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#f1fa8c">&#34;SHELL = </span><span style="color:#ff79c6">$(</span>SHELL<span style="color:#ff79c6">)</span><span style="color:#f1fa8c">&#34;</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#f1fa8c">&#34;MAKE = </span><span style="color:#ff79c6">$(</span>MAKE<span style="color:#ff79c6">)</span><span style="color:#f1fa8c">&#34;</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#f1fa8c">&#34;HOSTNAME = </span><span style="color:#ff79c6">$(</span>HOSTNAME<span style="color:#ff79c6">)</span><span style="color:#f1fa8c">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># CFLAGS = -g
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"># SHELL = D:/sortwares/Git/usr/bin/sh.exe
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"># MAKE = D:/sortwares/mingw64/bin/make
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"># HOSTNAME = TX-PC0N4UHP
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 运行make 可以传值改变 export方式
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"># make HOSTNAME=CodeMax
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"># HOSTNAME = CodeMax
</span></span></span></code></pre></div><ul>
<li>条件判断</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#6272a4"># ifeq 判断相等
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">mode</span> <span style="color:#ff79c6">=</span> debug
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">echo</span><span style="color:#ff79c6">:</span>
</span></span><span style="display:flex;"><span>ifeq (<span style="color:#ff79c6">$(</span><span style="color:#8be9fd;font-style:italic">mode</span><span style="color:#ff79c6">)</span>,debug)
</span></span><span style="display:flex;"><span>	@echo <span style="color:#f1fa8c">&#34;debug mode&#34;</span>
</span></span><span style="display:flex;"><span>else
</span></span><span style="display:flex;"><span>	@echo <span style="color:#f1fa8c">&#34;release mode&#34;</span>
</span></span><span style="display:flex;"><span>endif
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># ifneq
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#50fa7b">echo</span><span style="color:#ff79c6">:</span>
</span></span><span style="display:flex;"><span>ifeq (<span style="color:#ff79c6">$(</span><span style="color:#8be9fd;font-style:italic">mode</span><span style="color:#ff79c6">)</span>,)
</span></span><span style="display:flex;"><span>	@echo <span style="color:#f1fa8c">&#34;debug mode&#34;</span>
</span></span><span style="display:flex;"><span>else
</span></span><span style="display:flex;"><span>	@echo <span style="color:#f1fa8c">&#34;release mode&#34;</span>
</span></span><span style="display:flex;"><span>endif
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># ifdef
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#50fa7b">echo</span><span style="color:#ff79c6">:</span>
</span></span><span style="display:flex;"><span>ifdef mode
</span></span><span style="display:flex;"><span>	@echo <span style="color:#f1fa8c">&#34;debug mode&#34;</span>
</span></span><span style="display:flex;"><span>else
</span></span><span style="display:flex;"><span>	@echo <span style="color:#f1fa8c">&#34;release mode&#34;</span>
</span></span><span style="display:flex;"><span>endif
</span></span></code></pre></div><ul>
<li>函数</li>
</ul>
<ol>
<li>自定义函数 通过call调用</li>
<li>make内嵌函数  直接make调用</li>
<li>函数与参数使用空格隔开 参数之间使用,隔开</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#6272a4"># 内嵌函数
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">SRC</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">$(</span>wildcard *.cpp<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">echo</span><span style="color:#ff79c6">:</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#f1fa8c">&#34;SRC = </span><span style="color:#ff79c6">$(</span>SRC<span style="color:#ff79c6">)</span><span style="color:#f1fa8c">&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#6272a4"># 自定义函数
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>define func
</span></span><span style="display:flex;"><span>	@echo <span style="color:#f1fa8c">&#34;param1 = $(0)&#34;</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#f1fa8c">&#34;param = $(1)&#34;</span>
</span></span><span style="display:flex;"><span>endef
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">echo</span><span style="color:#ff79c6">:</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">$(</span>call func, hello world<span style="color:#ff79c6">)</span>
</span></span></code></pre></div><ul>
<li>遍历 foreach</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#ff79c6">$(</span><span style="color:#8be9fd;font-style:italic">foreach</span> <span style="color:#8be9fd;font-style:italic">VAR</span>, <span style="color:#8be9fd;font-style:italic">LIST</span>, <span style="color:#8be9fd;font-style:italic">TEXT</span><span style="color:#ff79c6">)</span>
</span></span></code></pre></div><ol>
<li>VAR 将空格隔开的每一个选项赋值给VAR</li>
<li>TEXT 处理VAR的脚本</li>
</ol>
<ul>
<li>if 函数</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#6272a4"># $(if(condition, then[, else]))
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">install__path</span> <span style="color:#ff79c6">=</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">install_path</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">$(if</span> <span style="color:#ff79c6">$(</span>install__path<span style="color:#ff79c6">)</span>, <span style="color:#ff79c6">$(</span>install__path<span style="color:#ff79c6">)</span>, /usr/local<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">echo</span><span style="color:#ff79c6">:</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">$(</span>install_path<span style="color:#ff79c6">)</span><span style="color:#f1fa8c">&#34;</span>
</span></span></code></pre></div><ul>
<li>call 函数</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#6272a4"># $(call def_func, &lt;parm1&gt;, &lt;param2&gt;...)
</span></span></span></code></pre></div><ul>
<li>error warning 函数</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#6272a4"># $(error TEXT...)
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"># $(warning TEXT...)
</span></span></span></code></pre></div><h2 id="example">example</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#6272a4"># 如果当前目录中，正好有一个文件叫做clean，那么这个命令不会执行。
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"># 因为Make发现clean文件已经存在，就认为没有必要重新构建了，就不会执行指定的rm命令
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"># 就有了下面的伪声明
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#50fa7b">.PHONY</span><span style="color:#ff79c6">:</span> clean
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 编译Cpp
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">CC</span> <span style="color:#ff79c6">=</span> g++
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 设置编译参数设置
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"># -g表示编译时候加入调试信息,
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"># -DDEBUG表示编译debug版本
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"># -W -Wall表示输出所有警告
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"># -fPIC是生成dll时候用的
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">CFLAGS</span> <span style="color:#ff79c6">=</span> -g -DDEBUG -W -Wall -fPIC
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 头文件的目录为./ 当前目录
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">HEADER</span>  <span style="color:#ff79c6">=</span> -I./
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">ALGONAME</span> <span style="color:#ff79c6">=</span> AddTwoSum
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">TOOLNAME</span> <span style="color:#ff79c6">=</span> utils
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">OBJS</span><span style="color:#ff79c6">=</span> <span style="color:#ff79c6">$(</span>ALGONAME<span style="color:#ff79c6">)</span>.o <span style="color:#ff79c6">$(</span>TOOLNAME<span style="color:#ff79c6">)</span>.o
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">TARGET</span> <span style="color:#ff79c6">=</span> algo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">$(TARGET)</span><span style="color:#ff79c6">:</span> <span style="color:#ff79c6">$(</span><span style="color:#8be9fd;font-style:italic">OBJS</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#f1fa8c">&#34;start compiling...&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">$(</span>CC<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">$(</span>CFLAGS<span style="color:#ff79c6">)</span> -o <span style="color:#8be9fd;font-style:italic">$@</span> $^
</span></span><span style="display:flex;"><span>	@echo <span style="color:#f1fa8c">&#34;compile done&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">$(ALGONAME).o</span><span style="color:#ff79c6">:</span> <span style="color:#ff79c6">$(</span><span style="color:#8be9fd;font-style:italic">ALGONAME</span><span style="color:#ff79c6">)</span>.cpp
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">$(</span>CC<span style="color:#ff79c6">)</span> -c -o <span style="color:#8be9fd;font-style:italic">$@</span> $&lt;
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">$(TOOLNAME).o</span><span style="color:#ff79c6">:</span> <span style="color:#ff79c6">$(</span><span style="color:#8be9fd;font-style:italic">TOOLNAME</span><span style="color:#ff79c6">)</span>.cpp
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">$(</span>CC<span style="color:#ff79c6">)</span> -c -o <span style="color:#8be9fd;font-style:italic">$@</span> $&lt;
</span></span><span style="display:flex;"><span><span style="color:#50fa7b">clean</span><span style="color:#ff79c6">:</span>
</span></span><span style="display:flex;"><span>	rm -f <span style="color:#ff79c6">$(</span>TARGET<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">$(</span>OBJS<span style="color:#ff79c6">)</span>
</span></span></code></pre></div><h2 id="参考">参考</h2>
<ul>
<li><a href="https://www.zhaixue.cc/makefile/makefile-pattern.html">参考文档-1</a></li>
<li><a href="https://www.ruanyifeng.com/blog/2015/02/make.html">参考文档-2</a></li>
</ul>

    </div>
</article>


<aside class="toc-sidebar">
    <div class="toc-sticky">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#make指令">make指令</a></li>
    <li><a href="#编译过程">编译过程</a></li>
    <li><a href="#makefile">Makefile</a></li>
    <li><a href="#example">example</a></li>
    <li><a href="#参考">参考</a></li>
  </ul>
</nav>
    </div>
</aside>



            

         </div>
      </div>
   </div>
</body>

</html>