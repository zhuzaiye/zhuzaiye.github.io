
<!DOCTYPE html>
<html lang="en" class="dark light">


<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="base" content="https://zhuzaiye.github.io/">

    
    

    
    
        <title>Makefile-ABC</title>
        
            <meta property="og:title" content="Makefile-ABC" />
        
    

    
        
            <meta property="og:description" content="Makefile基础知识和应用" />
        
    

    
        
            <meta name="description" content="Makefile基础知识和应用" />
        
    

    
        <link rel="icon" type="image/png" href="/icon/favicon.png" />
    

    
        
        <link rel="stylesheet" href="/sass/fonts.min.8631b5498d7736f82c926ea3193874edc64e922a34c30038c7c8368671494ea1.css" />
    

    

    
        <script src="/js/codeblock.js"></script>
    

    

    
        <script src="/js/note.js"></script>
    

    
        
            <script>
            MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };
            </script>
        
        <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    

    <link rel="alternate" type="application/atom+xml" title="hzzhu" href="/index.xml">

    
    
        
        
        <link rel="stylesheet" href="/sass/theme/light.min.edb28b5538eafa2e4e6cda9672e5fbb084ba7992cb6cb3e0674410fa10e51f22.css" />
        <link id="darkModeStyle" rel="stylesheet" href="/sass/theme/dark.min.c7a36ede12c4fa8139f2591d76d4972e30fc281264c6a60c06f3121d91e19d71.css" />
    

    
        <script src="/js/themetoggle.js"></script>
        
            <script>setTheme(getSavedTheme());</script>
        
    

    
    <link rel="stylesheet" href="/sass/main.min.b1515c6ec232b60ef38367cea9e6de123e7c4782770a8e3a69a63ef41646ceca.css" />

    

    
</head>

<body>
   <div class="content">
      
      <header>
    <div class="main">
        
            <a href="https://zhuzaiye.github.io/">hzzhu</a>
        

        <div class="socials">
            
                <a rel="me" href="https://github.com/zhuzaiye/" class="social">
                    <img alt="github" src="/icons/social/github.svg">
                </a>
            
                <a rel="me" href="mailto:hzzhu92@gmail.com" class="social">
                    <img alt="email" src="/icons/social/email.svg">
                </a>
            
                <a rel="me" href="https://twitter.com/pigzhu11" class="social">
                    <img alt="twitter" src="/icons/social/twitter.svg">
                </a>
            
                <a rel="me" href="/index.xml" class="social">
                    <img alt="rss" src="/icons/social/rss.svg">
                </a>
            
        </div>
    </div>

    <nav>
        
            <a href="/posts" style="margin-left: 0.25em">/posts</a>
        
            <a href="/projects" style="margin-left: 0.25em">/projects</a>
        
            <a href="/about" style="margin-left: 0.25em">/about</a>
        
        |
        
            <a id="dark-mode-toggle" onclick="toggleTheme(); event.preventDefault();" href="#">
                <img src="/icons/sun.svg" id="sun-icon" style="filter: invert(1)" alt="Light" />
                <img src="/icons/moon.svg" id="moon-icon" alt="Dark" />
            </a>
            
            
            <script>updateItemToggleTheme()</script>
        
    </nav>
</header>

      
      
    
    <main>
        <article>
            <div class="title">
                
    <div class="page-header">
        Makefile-ABC<span class="primary-color" style="font-size: 1.6em">.</span>
    </div>


                <div class="meta">
                    Posted on <time>2023-03-25</time>
                    
                    
                    
                </div>
            </div>

            

            <section class="body">
                <p>Makefile是组织编译的命令脚本文件-构建生成可执行文件的依赖关系树.</p>
<blockquote>
<p><code>make</code>根据makefile的规则关系树, 构建出编译可执行程序.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#75715e"># 目标: 目标依赖
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#     命令
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">a.out</span><span style="color:#f92672">:</span> demo.c
</span></span><span style="display:flex;"><span>    gcc -o $@ $&lt;
</span></span></code></pre></div><h2 id="make指令">make指令</h2>
<blockquote>
<p>windows 环境</p>
</blockquote>
<p>运行<code>make -v</code>会出现:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#e6db74">&#39;make&#39;</span> 不是内部命或外部命令, 也不是可执行的程序, 或批处理文件.
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 系统在环境变量中找不到 make 命令执行文件</span>
</span></span></code></pre></div><p>解决方法:</p>
<ol>
<li>找到<code>mingw</code>安装目录, 打开<code>bin</code>目录, 找到<code>mingw32-make.exe</code></li>
<li>将<code>mingw32-make.exe</code>将该文件重命名为<code>make.exe</code></li>
</ol>
<h2 id="编译过程">编译过程</h2>
<p><img src="/img/blog/compiler.jpg" alt="cimpiler_processer"></p>
<h2 id="makefile">Makefile</h2>
<ul>
<li>变量 使用 <code>$(val)</code> 获取<code>val</code>的值</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#a6e22e">.PHONY</span><span style="color:#f92672">:</span> clean
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>CC<span style="color:#f92672">=</span>g++
</span></span><span style="display:flex;"><span>BIN<span style="color:#f92672">=</span>exec
</span></span><span style="display:flex;"><span>OBJS<span style="color:#f92672">=</span>AddTwoSum.o utils.o
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">$(BIN)</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">$(</span>OBJS<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#e6db74">&#34;start compiling...&#34;</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#66d9ef">$(</span>CC<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">$(</span>CC<span style="color:#66d9ef">)</span> -o <span style="color:#66d9ef">$(</span>BIN<span style="color:#66d9ef">)</span> <span style="color:#66d9ef">$(</span>OBJS<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#e6db74">&#34;compile done&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">AddTwoSum.o</span><span style="color:#f92672">:</span> AddTwoSum.cpp
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">$(</span>CC<span style="color:#66d9ef">)</span> -c -o $@ $&lt;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">utils.o</span><span style="color:#f92672">:</span> utils.cpp
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">$(</span>CC<span style="color:#66d9ef">)</span> -c -o $@ $&lt;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">clean</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>	rm -f <span style="color:#66d9ef">$(</span>BIN<span style="color:#66d9ef">)</span> <span style="color:#66d9ef">$(</span>OBJS<span style="color:#66d9ef">)</span>
</span></span></code></pre></div><ul>
<li>条件复制</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#75715e">#条件赋值 ?=
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#追加赋值 +=
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>CC <span style="color:#f92672">=</span> g++
</span></span><span style="display:flex;"><span>CC <span style="color:#f92672">?=</span> gcc
</span></span><span style="display:flex;"><span>OBJS <span style="color:#f92672">=</span> AddTwoSum.o
</span></span><span style="display:flex;"><span>OBJS <span style="color:#f92672">+=</span> utils.o
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">echo</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#66d9ef">$(</span>CC<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#66d9ef">$(</span>OBJS<span style="color:#66d9ef">)</span>
</span></span></code></pre></div><ul>
<li>立即变量和延迟变量</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#75715e"># 使用 := 赋值, 立即变量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># 使用 = 赋值, 延迟变量(关系变量)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>a <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>b <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>val_a <span style="color:#f92672">:=</span> <span style="color:#66d9ef">$(</span>a<span style="color:#66d9ef">)</span> <span style="color:#75715e"># val_a=1 解析即赋值 立即解析赋值</span>
</span></span><span style="display:flex;"><span>val_b <span style="color:#f92672">=</span> <span style="color:#66d9ef">$(</span>b<span style="color:#66d9ef">)</span>  <span style="color:#75715e"># val_b的值随着b的变化而变化 绑定变量关系</span>
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># b = 20
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">echo</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#66d9ef">$(</span>val_a<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#66d9ef">$(</span>val_b<span style="color:#66d9ef">)</span>
</span></span></code></pre></div><ul>
<li>自动变量</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#75715e"># 常用自动变量
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># $@ 目标
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># $^ 所有依赖项
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># $&lt; 目标依赖项中的第一个
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># $? 所有依赖项中被修改过的
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">.PHONY</span><span style="color:#f92672">:</span> clean
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>CC<span style="color:#f92672">=</span>g++
</span></span><span style="display:flex;"><span>BIN<span style="color:#f92672">=</span>exec
</span></span><span style="display:flex;"><span>OBJS<span style="color:#f92672">=</span>AddTwoSum.o utils.o
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">$(BIN)</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">$(</span>OBJS<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#e6db74">&#34;start compiling...&#34;</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#66d9ef">$(</span>CC<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">$(</span>CC<span style="color:#66d9ef">)</span> -o $@ $^
</span></span><span style="display:flex;"><span>	@echo <span style="color:#e6db74">&#34;compile done&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">AddTwoSum.o</span><span style="color:#f92672">:</span> AddTwoSum.cpp
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">$(</span>CC<span style="color:#66d9ef">)</span> -c -o $@ $&lt;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">utils.o</span><span style="color:#f92672">:</span> utils.cpp
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">$(</span>CC<span style="color:#66d9ef">)</span> -c -o $@ $&lt;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">clean</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>	rm -f <span style="color:#66d9ef">$(</span>BIN<span style="color:#66d9ef">)</span> <span style="color:#66d9ef">$(</span>OBJS<span style="color:#66d9ef">)</span>
</span></span></code></pre></div><ul>
<li>变量替换(模式匹配)</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#a6e22e">.PHONY</span><span style="color:#f92672">:</span> echo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>SRC <span style="color:#f92672">=</span> demo.c demo1.c
</span></span><span style="display:flex;"><span>OBJ <span style="color:#f92672">=</span> <span style="color:#66d9ef">$(</span>SRC:.c<span style="color:#f92672">=</span>.o<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>OBJ1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">$(</span>SRC:%.c<span style="color:#f92672">=</span>%.o<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">echo</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#e6db74">&#34;SRC=</span><span style="color:#66d9ef">$(</span>SRC<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#e6db74">&#34;OBJ=</span><span style="color:#66d9ef">$(</span>OBJ<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#e6db74">&#34;OBJ1=</span><span style="color:#66d9ef">$(</span>OBJ1<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># SRC=demo.c demo1.c
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># OBJ=demo.o demo1.o
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># OBJ1=demo.o demo1.o
</span></span></span></code></pre></div><ul>
<li>环境变量</li>
</ul>
<p>环境变量运行时载入makefile. 如果有相同命名的变量, 系统环境变量会被覆盖.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#a6e22e">.PHONY</span><span style="color:#f92672">:</span> echo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>CFLAGS <span style="color:#f92672">=</span> -g
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">echo</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#e6db74">&#34;CFLAGS = </span><span style="color:#66d9ef">$(</span>CFLAGS<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#e6db74">&#34;SHELL = </span><span style="color:#66d9ef">$(</span>SHELL<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#e6db74">&#34;MAKE = </span><span style="color:#66d9ef">$(</span>MAKE<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#e6db74">&#34;HOSTNAME = </span><span style="color:#66d9ef">$(</span>HOSTNAME<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># CFLAGS = -g
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># SHELL = D:/sortwares/Git/usr/bin/sh.exe
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># MAKE = D:/sortwares/mingw64/bin/make
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># HOSTNAME = TX-PC0N4UHP
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 运行make 可以传值改变 export方式
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># make HOSTNAME=CodeMax
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># HOSTNAME = CodeMax
</span></span></span></code></pre></div><ul>
<li>条件判断</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#75715e"># ifeq 判断相等
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>mode <span style="color:#f92672">=</span> debug
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">echo</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">ifeq</span> <span style="color:#960050;background-color:#1e0010">(</span><span style="color:#66d9ef">$(</span>mode<span style="color:#66d9ef">)</span><span style="color:#960050;background-color:#1e0010">,debug)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#960050;background-color:#1e0010">@echo</span> <span style="color:#e6db74">&#34;debug mode&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">else</span>
</span></span><span style="display:flex;"><span>	<span style="color:#960050;background-color:#1e0010">@echo</span> <span style="color:#e6db74">&#34;release mode&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">endif</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ifneq
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">echo</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">ifeq</span> <span style="color:#960050;background-color:#1e0010">(</span><span style="color:#66d9ef">$(</span>mode<span style="color:#66d9ef">)</span><span style="color:#960050;background-color:#1e0010">,)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#960050;background-color:#1e0010">@echo</span> <span style="color:#e6db74">&#34;debug mode&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">else</span>
</span></span><span style="display:flex;"><span>	<span style="color:#960050;background-color:#1e0010">@echo</span> <span style="color:#e6db74">&#34;release mode&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">endif</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ifdef
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">echo</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">ifdef</span> <span style="color:#960050;background-color:#1e0010">mode</span>
</span></span><span style="display:flex;"><span>	<span style="color:#960050;background-color:#1e0010">@echo</span> <span style="color:#e6db74">&#34;debug mode&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">else</span>
</span></span><span style="display:flex;"><span>	<span style="color:#960050;background-color:#1e0010">@echo</span> <span style="color:#e6db74">&#34;release mode&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">endif</span>
</span></span></code></pre></div><ul>
<li>函数</li>
</ul>
<ol>
<li>自定义函数 通过call调用</li>
<li>make内嵌函数  直接make调用</li>
<li>函数与参数使用空格隔开 参数之间使用,隔开</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#75715e"># 内嵌函数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>SRC <span style="color:#f92672">=</span> <span style="color:#66d9ef">$(</span>wildcard *.cpp<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">echo</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#e6db74">&#34;SRC = </span><span style="color:#66d9ef">$(</span>SRC<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#75715e"># 自定义函数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">define</span> <span style="color:#960050;background-color:#1e0010">func</span>
</span></span><span style="display:flex;"><span>	<span style="color:#960050;background-color:#1e0010">@echo</span> <span style="color:#e6db74">&#34;param1 = $(0)&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#960050;background-color:#1e0010">@echo</span> <span style="color:#e6db74">&#34;param = $(1)&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">endef</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">echo</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">$(</span>call func, hello world<span style="color:#66d9ef">)</span>
</span></span></code></pre></div><ul>
<li>遍历 foreach</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#66d9ef">$(</span>foreach VAR, LIST, TEXT<span style="color:#66d9ef">)</span>
</span></span></code></pre></div><ol>
<li>VAR 将空格隔开的每一个选项赋值给VAR</li>
<li>TEXT 处理VAR的脚本</li>
</ol>
<ul>
<li>if 函数</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#75715e"># $(if(condition, then[, else]))
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>install__path <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>install_path <span style="color:#f92672">=</span> <span style="color:#66d9ef">$(if</span> <span style="color:#66d9ef">$(</span>install__path<span style="color:#66d9ef">)</span>, <span style="color:#66d9ef">$(</span>install__path<span style="color:#66d9ef">)</span>, /usr/local<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">echo</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>install_path<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span>
</span></span></code></pre></div><ul>
<li>call 函数</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#75715e"># $(call def_func, &lt;parm1&gt;, &lt;param2&gt;...)
</span></span></span></code></pre></div><ul>
<li>error warning 函数</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#75715e"># $(error TEXT...)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># $(warning TEXT...)
</span></span></span></code></pre></div><h2 id="example">example</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#75715e"># 如果当前目录中，正好有一个文件叫做clean，那么这个命令不会执行。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># 因为Make发现clean文件已经存在，就认为没有必要重新构建了，就不会执行指定的rm命令
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># 就有了下面的伪声明
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">.PHONY</span><span style="color:#f92672">:</span> clean
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 编译Cpp
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>CC <span style="color:#f92672">=</span> g++
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 设置编译参数设置
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># -g表示编译时候加入调试信息,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># -DDEBUG表示编译debug版本
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># -W -Wall表示输出所有警告
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># -fPIC是生成dll时候用的
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>CFLAGS <span style="color:#f92672">=</span> -g -DDEBUG -W -Wall -fPIC
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 头文件的目录为./ 当前目录
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>HEADER  <span style="color:#f92672">=</span> -I./
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ALGONAME <span style="color:#f92672">=</span> AddTwoSum
</span></span><span style="display:flex;"><span>TOOLNAME <span style="color:#f92672">=</span> utils
</span></span><span style="display:flex;"><span>OBJS<span style="color:#f92672">=</span> <span style="color:#66d9ef">$(</span>ALGONAME<span style="color:#66d9ef">)</span>.o <span style="color:#66d9ef">$(</span>TOOLNAME<span style="color:#66d9ef">)</span>.o
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>TARGET <span style="color:#f92672">=</span> algo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">$(TARGET)</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">$(</span>OBJS<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>	@echo <span style="color:#e6db74">&#34;start compiling...&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">$(</span>CC<span style="color:#66d9ef">)</span> <span style="color:#66d9ef">$(</span>CFLAGS<span style="color:#66d9ef">)</span> -o $@ $^
</span></span><span style="display:flex;"><span>	@echo <span style="color:#e6db74">&#34;compile done&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">$(ALGONAME).o</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">$(</span>ALGONAME<span style="color:#66d9ef">)</span>.cpp
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">$(</span>CC<span style="color:#66d9ef">)</span> -c -o $@ $&lt;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">$(TOOLNAME).o</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">$(</span>TOOLNAME<span style="color:#66d9ef">)</span>.cpp
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">$(</span>CC<span style="color:#66d9ef">)</span> -c -o $@ $&lt;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">clean</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>	rm -f <span style="color:#66d9ef">$(</span>TARGET<span style="color:#66d9ef">)</span> <span style="color:#66d9ef">$(</span>OBJS<span style="color:#66d9ef">)</span>
</span></span></code></pre></div><h2 id="参考">参考</h2>
<ul>
<li><a href="https://www.zhaixue.cc/makefile/makefile-pattern.html">参考文档-1</a></li>
<li><a href="https://www.ruanyifeng.com/blog/2015/02/make.html">参考文档-2</a></li>
</ul>

            </section>
        </article>
    </main>



      


   </div>
</body>

</html>